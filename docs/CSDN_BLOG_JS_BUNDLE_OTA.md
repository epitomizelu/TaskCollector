# React Native è‡ªå»º JS Bundle OTA æ›´æ–°ç³»ç»Ÿï¼šä»é›¶åˆ°ä¸€çš„å®Œæ•´å®ç°ä¸è¸©å‘è®°å½•

## ğŸ“ æ‘˜è¦

æœ¬æ–‡è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ React Native + Expo é¡¹ç›®ä¸­å®ç°è‡ªå»º JS Bundle OTAï¼ˆOver-The-Airï¼‰æ›´æ–°ç³»ç»Ÿï¼ŒåŒ…æ‹¬ç³»ç»Ÿæ¶æ„è®¾è®¡ã€æ ¸å¿ƒå®ç°åŸç†ã€åˆ†ç‰‡ä¸Šä¼ æ–¹æ¡ˆï¼Œä»¥åŠå¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„å„ç§å‘å’Œè§£å†³æ–¹æ¡ˆã€‚é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†å­¦ä¼šå¦‚ä½•åœ¨ä¸é‡æ–°å®‰è£… APK çš„æƒ…å†µä¸‹ï¼Œå®ç° JavaScript ä»£ç çš„çƒ­æ›´æ–°ã€‚

**å…³é”®è¯**ï¼šReact Nativeã€Expoã€OTA æ›´æ–°ã€JS Bundleã€åˆ†ç‰‡ä¸Šä¼ ã€çƒ­æ›´æ–°

---

## ğŸ“‘ ç›®å½•

1. [èƒŒæ™¯ä¸éœ€æ±‚](#1-èƒŒæ™¯ä¸éœ€æ±‚)
2. [ç³»ç»Ÿæ¶æ„è®¾è®¡](#2-ç³»ç»Ÿæ¶æ„è®¾è®¡)
3. [æ ¸å¿ƒå®ç°åŸç†](#3-æ ¸å¿ƒå®ç°åŸç†)
4. [åˆ†ç‰‡ä¸Šä¼ æ–¹æ¡ˆ](#4-åˆ†ç‰‡ä¸Šä¼ æ–¹æ¡ˆ)
5. [ç‰ˆæœ¬ç®¡ç†æœºåˆ¶](#5-ç‰ˆæœ¬ç®¡ç†æœºåˆ¶)
6. [è¸©å‘è®°å½•ä¸è§£å†³æ–¹æ¡ˆ](#6-è¸©å‘è®°å½•ä¸è§£å†³æ–¹æ¡ˆ)
7. [å®Œæ•´ä»£ç å®ç°](#7-å®Œæ•´ä»£ç å®ç°)
8. [æ€»ç»“ä¸å±•æœ›](#8-æ€»ç»“ä¸å±•æœ›)

---

## 1. èƒŒæ™¯ä¸éœ€æ±‚

### 1.1 ä¸ºä»€ä¹ˆéœ€è¦è‡ªå»º OTA ç³»ç»Ÿï¼Ÿ

åœ¨ React Native å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ä»¥ä¸‹æ›´æ–°æ–¹å¼ï¼š

- **EAS OTA æ›´æ–°**ï¼šå®˜æ–¹æ–¹æ¡ˆï¼Œä½†éœ€è¦ä»˜è´¹ï¼Œä¸”åŠŸèƒ½å—é™
- **APK æ›´æ–°**ï¼šéœ€è¦ç”¨æˆ·é‡æ–°å®‰è£…ï¼Œä½“éªŒå·®
- **è‡ªå»º OTA ç³»ç»Ÿ**ï¼šå®Œå…¨å¯æ§ï¼Œæ”¯æŒè‡ªå®šä¹‰é€»è¾‘ï¼Œæˆæœ¬ä½

æˆ‘ä»¬çš„éœ€æ±‚ï¼š
- âœ… æ”¯æŒå¤§æ–‡ä»¶ä¸Šä¼ ï¼ˆ>10MBï¼‰
- âœ… ç‹¬ç«‹çš„ç‰ˆæœ¬ç®¡ç†ï¼ˆä¸ APK ç‰ˆæœ¬åˆ†ç¦»ï¼‰
- âœ… ä»…æ”¯æŒæ‰‹åŠ¨æ›´æ–°ï¼ˆç”¨æˆ·å¯æ§ï¼‰
- âœ… æ”¯æŒåŠ¨æ€æ‰§è¡Œ JS ä»£ç ï¼ˆæ— éœ€é‡å¯ï¼‰

### 1.2 æŠ€æœ¯æ ˆ

- **å‰ç«¯**ï¼šReact Native + Expo
- **åç«¯**ï¼šè…¾è®¯äº‘å¼€å‘ï¼ˆTCBï¼‰
- **å­˜å‚¨**ï¼šè…¾è®¯äº‘å¯¹è±¡å­˜å‚¨ï¼ˆCOSï¼‰
- **æ•°æ®åº“**ï¼šè…¾è®¯äº‘æ•°æ®åº“ï¼ˆMongoDBï¼‰

---

## 2. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¼€å‘è€…ç«¯      â”‚
â”‚  (ä¸Šä¼ è„šæœ¬)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ åˆ†ç‰‡ä¸Šä¼ 
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   äº‘å‡½æ•°        â”‚
â”‚ (app-update-api)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
    â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ COS  â”‚  â”‚ æ•°æ®åº“â”‚
â”‚å­˜å‚¨  â”‚  â”‚ç‰ˆæœ¬ç®¡ç†â”‚
â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ æ£€æŸ¥æ›´æ–°
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯ App    â”‚
â”‚  (æ‰‹åŠ¨æ›´æ–°)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒç»„ä»¶

1. **ä¸Šä¼ è„šæœ¬**ï¼šæ„å»ºå¹¶ä¸Šä¼  JS Bundle åˆ°äº‘å­˜å‚¨
2. **äº‘å‡½æ•°**ï¼šå¤„ç†åˆ†ç‰‡ä¸Šä¼ ã€åˆå¹¶ã€ç‰ˆæœ¬ç®¡ç†
3. **å®¢æˆ·ç«¯æœåŠ¡**ï¼šæ£€æŸ¥æ›´æ–°ã€ä¸‹è½½ã€åº”ç”¨æ›´æ–°
4. **æ•°æ®åº“**ï¼šå­˜å‚¨ç‰ˆæœ¬ä¿¡æ¯å’Œåˆå¹¶ä»»åŠ¡

---

## 3. æ ¸å¿ƒå®ç°åŸç†

### 3.1 ç‰ˆæœ¬ç®¡ç†æœºåˆ¶

**å…³é”®è®¾è®¡**ï¼šJS Bundle æ›´æ–°ä½¿ç”¨ç‹¬ç«‹çš„ `jsVersionCode`ï¼Œä¸ APK çš„ `versionCode` å®Œå…¨åˆ†ç¦»ã€‚

```javascript
// APK ç‰ˆæœ¬ç®¡ç†
{
  version: "1.0.0",
  versionCode: 2  // ä» app.json è¯»å–
}

// JS Bundle ç‰ˆæœ¬ç®¡ç†
{
  version: "1.0.0",      // æ˜¾ç¤ºç”¨ï¼Œä¸ APK ç‰ˆæœ¬ä¸€è‡´
  jsVersionCode: 1       // ç‹¬ç«‹ç®¡ç†ï¼Œè‡ªåŠ¨é€’å¢
}
```

**ä¼˜åŠ¿**ï¼š
- JS Bundle å¯ä»¥é¢‘ç¹æ›´æ–°ï¼Œä¸å½±å“ APK ç‰ˆæœ¬
- ç‰ˆæœ¬å·æ¸…æ™°ï¼Œä¸ä¼šæ··æ·†
- æ”¯æŒå›æ»šåˆ°ä»»æ„ JS Bundle ç‰ˆæœ¬

### 3.2 è‡ªåŠ¨é€’å¢æœºåˆ¶

æ¯æ¬¡ä¸Šä¼  JS Bundle æ—¶ï¼Œäº‘å‡½æ•°è‡ªåŠ¨æŸ¥è¯¢å½“å‰å¹³å°çš„æœ€å¤§ `jsVersionCode`ï¼Œç„¶å +1ï¼š

```javascript
// æŸ¥è¯¢å½“å‰æœ€å¤§ jsVersionCode
const existingVersions = await collection
  .where({ platform: platform })
  .orderBy('jsVersionCode', 'desc')
  .limit(1)
  .get();

let jsVersionCode = 1;
if (existingVersions.data && existingVersions.data.length > 0) {
  const maxJsVersionCode = existingVersions.data[0].jsVersionCode;
  jsVersionCode = maxJsVersionCode + 1;
}
```

### 3.3 å®¢æˆ·ç«¯ç‰ˆæœ¬å­˜å‚¨

å®¢æˆ·ç«¯å°† `jsVersionCode` ä¿å­˜åœ¨æœ¬åœ°å­˜å‚¨ä¸­ï¼š

```typescript
// ä¿å­˜è·¯å¾„
const infoPath = `${FileSystem.documentDirectory}js_bundle_version_code.json`;

// ä¿å­˜å†…å®¹
{
  jsVersionCode: 2,
  updatedAt: "2025-01-11T..."
}
```

**é¦–æ¬¡ä½¿ç”¨**ï¼šé»˜è®¤ `jsVersionCode = 0`ï¼Œç¡®ä¿èƒ½æ£€æµ‹åˆ°ç¬¬ä¸€æ¬¡æ›´æ–°ã€‚

---

## 4. åˆ†ç‰‡ä¸Šä¼ æ–¹æ¡ˆ

### 4.1 ä¸ºä»€ä¹ˆéœ€è¦åˆ†ç‰‡ä¸Šä¼ ï¼Ÿ

**é—®é¢˜**ï¼šäº‘å‡½æ•°çš„è¯·æ±‚ä½“å¤§å°é™åˆ¶ä¸º 6MBï¼Œè€Œæˆ‘ä»¬çš„ JS Bundle æ–‡ä»¶é€šå¸¸ >10MBã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šå°†å¤§æ–‡ä»¶åˆ†å‰²æˆå¤šä¸ª 2MB çš„åˆ†ç‰‡ï¼Œé€ä¸ªä¸Šä¼ ï¼Œæœ€ååœ¨äº‘å‡½æ•°ä¸­åˆå¹¶ã€‚

### 4.2 åˆ†ç‰‡å¤§å°è®¾è®¡

```javascript
const CHUNK_SIZE = 2 * 1024 * 1024; // 2MBï¼ˆäºŒè¿›åˆ¶ï¼‰
// Base64 ç¼–ç åçº¦ 2.67MB
// åŠ ä¸Š JSON å­—æ®µï¼Œæ€»å¤§å°çº¦ 2.7MB
// ç¡®ä¿åœ¨äº‘å‡½æ•° 6MB é™åˆ¶å†…
```

### 4.3 åˆ†ç‰‡ä¸Šä¼ æµç¨‹

```
1. è¯»å–æ–‡ä»¶ â†’ 2. åˆ†å‰²æˆå¤šä¸ªåˆ†ç‰‡ â†’ 3. Base64 ç¼–ç 
    â†“
4. é€ä¸ªä¸Šä¼ åˆ†ç‰‡åˆ°äº‘å­˜å‚¨ï¼ˆä¸´æ—¶è·¯å¾„ï¼‰
    â†“
5. è·å–æ‰€æœ‰åˆ†ç‰‡çš„ä¸‹è½½ URL
    â†“
6. åˆ›å»ºåˆå¹¶ä»»åŠ¡ï¼ˆä¿å­˜åˆ°æ•°æ®åº“ï¼‰
    â†“
7. å¼‚æ­¥å¤„ç†åˆå¹¶ä»»åŠ¡ï¼ˆä¸‹è½½ â†’ åˆå¹¶ â†’ ä¸Šä¼ ï¼‰
    â†“
8. ä¿å­˜ç‰ˆæœ¬è®°å½•ï¼ˆè‡ªåŠ¨é€’å¢ jsVersionCodeï¼‰
```

### 4.4 å¼‚æ­¥åˆå¹¶ä»»åŠ¡

**ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ï¼Ÿ**

åˆå¹¶ä»»åŠ¡éœ€è¦ï¼š
- ä¸‹è½½å¤šä¸ªåˆ†ç‰‡ï¼ˆå¯èƒ½å¾ˆæ…¢ï¼‰
- åˆå¹¶åˆ†ç‰‡ï¼ˆå†…å­˜æ“ä½œï¼‰
- ä¸Šä¼ å®Œæ•´æ–‡ä»¶ï¼ˆå¯èƒ½å¾ˆæ…¢ï¼‰

å¦‚æœåŒæ­¥æ‰§è¡Œï¼Œäº‘å‡½æ•°ä¼šè¶…æ—¶ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šåˆ›å»ºå¼‚æ­¥ä»»åŠ¡ï¼Œç«‹å³è¿”å›ï¼Œåå°å¤„ç†ã€‚

```javascript
// åˆ›å»ºåˆå¹¶ä»»åŠ¡
const taskData = {
  taskId: `merge_${Date.now()}_${randomId}`,
  uploadId: uploadId,
  totalChunks: totalChunks,
  chunkUrls: JSON.stringify(chunkUrls), // è½¬ä¸º JSON å­—ç¬¦ä¸²
  filePath: filePath,
  status: 'pending',
  progress: 0,
  createdAt: new Date().toISOString(),
};

await db.collection('merge_tasks').doc(taskId).set(taskData);

// å¼‚æ­¥å¤„ç†ï¼ˆä¸ç­‰å¾…å®Œæˆï¼‰
processMergeTask(taskId).catch(error => {
  // é”™è¯¯å¤„ç†
});
```

---

## 5. ç‰ˆæœ¬ç®¡ç†æœºåˆ¶

### 5.1 æ•°æ®åº“ç»“æ„

**`js_bundle_versions` é›†åˆ**ï¼š

```javascript
{
  _id: ObjectId("..."),
  version: "1.0.0",                    // APK ç‰ˆæœ¬å·ï¼ˆæ˜¾ç¤ºç”¨ï¼‰
  jsVersionCode: 1,                     // JS Bundle ç‰ˆæœ¬ä»£ç ï¼ˆæ¯”è¾ƒç”¨ï¼‰
  platform: "android",                 // å¹³å°
  bundleType: "js",                     // Bundle ç±»å‹
  downloadUrl: "https://...",          // ä¸‹è½½åœ°å€
  filePath: "js_bundles/v1.0.0/...",  // äº‘å­˜å‚¨è·¯å¾„
  fileSize: 11238318,                   // æ–‡ä»¶å¤§å°
  releaseDate: "2025-01-11T...",       // å‘å¸ƒæ—¥æœŸ
  createdAt: "2025-01-11T...",
  updatedAt: "2025-01-11T..."
}
```

### 5.2 æ£€æŸ¥æ›´æ–°é€»è¾‘

**å®¢æˆ·ç«¯**ï¼š
```typescript
// 1. ä»æœ¬åœ°å­˜å‚¨è¯»å–å½“å‰ jsVersionCode
await this.loadJsVersionCode(); // é»˜è®¤ 0

// 2. è°ƒç”¨äº‘å‡½æ•°æ£€æŸ¥æ›´æ–°
const response = await fetch(
  `${updateServiceUrl}/app/check-js-bundle-update?jsVersionCode=${this.currentJsVersionCode}&platform=${Platform.OS}`
);

// 3. å®¢æˆ·ç«¯äºŒæ¬¡æ ¡éªŒ
if (updateInfo.latestJsVersionCode <= this.currentJsVersionCode) {
  updateInfo.hasUpdate = false;
}
```

**äº‘å‡½æ•°**ï¼š
```javascript
// 1. æ¥æ”¶ jsVersionCode å‚æ•°
const currentJsVersionCode = parseInt(queryParams.get('jsVersionCode') || '0', 10);

// 2. æŸ¥è¯¢æœ€æ–°ç‰ˆæœ¬ï¼ˆæŒ‰ jsVersionCode é™åºï¼‰
const versions = await versionsCollection
  .where({ platform: platform })
  .orderBy('jsVersionCode', 'desc')
  .limit(1)
  .get();

// 3. æ¯”è¾ƒç‰ˆæœ¬
const hasUpdate = latestJsVersionCode > currentJsVersionCode;
```

### 5.3 åº”ç”¨æ›´æ–°é€»è¾‘

**ä¸‹è½½å®Œæˆå**ï¼š

```typescript
async applyUpdate(bundlePath: string, latestJsVersionCode: number) {
  const ext = bundlePath.split('.').pop()?.toLowerCase();
  
  if (ext === 'js') {
    // 1. åŠ¨æ€æ‰§è¡Œ JS Bundle
    await this.runBundle(bundlePath);
    
    // 2. ä¿å­˜æ–°çš„ jsVersionCode
    await this.saveJsVersionCode(latestJsVersionCode);
    
    Alert.alert('æ›´æ–°å®Œæˆ', 'æ–°ç‰ˆæœ¬å·²åº”ç”¨ï¼ˆæ— éœ€é‡å¯ï¼‰');
  } else if (ext === 'hbc') {
    // 1. ä¿å­˜æ›´æ–°ä¿¡æ¯
    await FileSystem.writeAsStringAsync(infoPath, JSON.stringify({
      bundlePath,
      jsVersionCode: latestJsVersionCode,
    }));
    
    // 2. ä¿å­˜æ–°çš„ jsVersionCode
    await this.saveJsVersionCode(latestJsVersionCode);
    
    Alert.alert('æ›´æ–°ä¸‹è½½å®Œæˆ', 'ä¸‹æ¬¡é‡å¯åå°†åº”ç”¨æ–°ç‰ˆæœ¬');
  }
}
```

---

## 6. è¸©å‘è®°å½•ä¸è§£å†³æ–¹æ¡ˆ

### ğŸ› å‘ 1ï¼šç›´æ¥ä¸Šä¼  COS çš„ç­¾åé—®é¢˜

**é—®é¢˜æè¿°**ï¼š
å°è¯•ç›´æ¥ä½¿ç”¨ HTTP PUT ä¸Šä¼ æ–‡ä»¶åˆ° COSï¼Œé‡åˆ° `SignatureDoesNotMatch` é”™è¯¯ã€‚

**é”™è¯¯ä¿¡æ¯**ï¼š
```
<Error>
  <Code>SignatureDoesNotMatch</Code>
  <Message>The Signature you specified is invalid.</Message>
</Error>
```

**åŸå› åˆ†æ**ï¼š
TCB çš„ `getUploadMetadata` è¿”å›çš„ `authorization` ç­¾åæ˜¯é’ˆå¯¹ç‰¹å®šè¯·æ±‚æ ¼å¼çš„ï¼Œç›´æ¥ç”¨äº HTTP PUT æ—¶ï¼Œheaders å¯èƒ½ä¸åŒ¹é…å¯¼è‡´ç­¾åéªŒè¯å¤±è´¥ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
æ”¾å¼ƒç›´æ¥ä¸Šä¼  COSï¼Œæ”¹ç”¨äº‘å‡½æ•°åˆ†ç‰‡ä¸Šä¼ æ–¹æ¡ˆï¼Œé¿å…ç­¾åé—®é¢˜ã€‚

**ç»éªŒæ€»ç»“**ï¼š
- TCB çš„ä¸´æ—¶å‡­è¯ä¸»è¦ç”¨äºå®¢æˆ·ç«¯ SDKï¼Œä¸é€‚åˆç›´æ¥ç”¨äº HTTP PUT
- å¤§æ–‡ä»¶ä¸Šä¼ åº”è¯¥é€šè¿‡äº‘å‡½æ•°ä¸­è½¬ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¸Šä¼ åˆ° COS

---

### ğŸ› å‘ 2ï¼šäº‘å‡½æ•° 6MB è¯·æ±‚ä½“é™åˆ¶

**é—®é¢˜æè¿°**ï¼š
å°è¯•é€šè¿‡äº‘å‡½æ•°ç›´æ¥ä¸Šä¼  10.72MB çš„ JS Bundle æ–‡ä»¶ï¼Œé‡åˆ° `read ECONNRESET` é”™è¯¯ã€‚

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: read ECONNRESET
```

**åŸå› åˆ†æ**ï¼š
äº‘å‡½æ•°çš„è¯·æ±‚ä½“å¤§å°é™åˆ¶ä¸º 6MBï¼ˆJSON æ ¼å¼ï¼‰ï¼Œè¶…è¿‡é™åˆ¶ä¼šå¯¼è‡´è¿æ¥é‡ç½®ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
å®ç°åˆ†ç‰‡ä¸Šä¼ æ–¹æ¡ˆï¼š
1. å°†æ–‡ä»¶åˆ†å‰²æˆå¤šä¸ª 2MB çš„åˆ†ç‰‡
2. æ¯ä¸ªåˆ†ç‰‡ Base64 ç¼–ç åçº¦ 2.67MB
3. é€ä¸ªä¸Šä¼ åˆ†ç‰‡åˆ°äº‘å­˜å‚¨
4. åœ¨äº‘å‡½æ•°ä¸­å¼‚æ­¥åˆå¹¶æ‰€æœ‰åˆ†ç‰‡

**ä»£ç å®ç°**ï¼š
```javascript
// åˆ†ç‰‡å¤§å°
const CHUNK_SIZE = 2 * 1024 * 1024; // 2MB

// åˆ†å‰²æ–‡ä»¶
const totalChunks = Math.ceil(fileContent.length / CHUNK_SIZE);
for (let i = 0; i < totalChunks; i++) {
  const start = i * CHUNK_SIZE;
  const end = Math.min(start + CHUNK_SIZE, fileContent.length);
  const chunk = fileContent.slice(start, end);
  const chunkBase64 = chunk.toString('base64');
  
  // ä¸Šä¼ åˆ†ç‰‡
  await uploadChunk(uploadId, i, chunkBase64, totalChunks);
}
```

**ç»éªŒæ€»ç»“**ï¼š
- äº‘å‡½æ•°æœ‰è¯·æ±‚ä½“å¤§å°é™åˆ¶ï¼Œå¤§æ–‡ä»¶å¿…é¡»åˆ†ç‰‡ä¸Šä¼ 
- åˆ†ç‰‡å¤§å°è¦åˆç†è®¾è®¡ï¼Œç¡®ä¿ Base64 ç¼–ç åä»åœ¨é™åˆ¶å†…

---

### ğŸ› å‘ 3ï¼šæ•°æ®åº“æ•°ç»„åºåˆ—åŒ–é—®é¢˜

**é—®é¢˜æè¿°**ï¼š
åˆå¹¶ä»»åŠ¡ä¸­ä¿å­˜çš„ `chunkUrls` æ•°ç»„ï¼Œä»æ•°æ®åº“è¯»å–åå˜æˆç©ºæ•°ç»„ã€‚

**é”™è¯¯ä¿¡æ¯**ï¼š
```
ä»»åŠ¡åˆ›å»ºå¤±è´¥: ä¿å­˜çš„ä»»åŠ¡ä¸­ chunkUrls ä¸ºç©º
```

**åŸå› åˆ†æ**ï¼š
è…¾è®¯äº‘æ•°æ®åº“å¯¹æ•°ç»„å­—æ®µçš„æ”¯æŒæœ‰é™ï¼Œç›´æ¥ä¿å­˜æ•°ç»„å¯èƒ½å¯¼è‡´åºåˆ—åŒ–é—®é¢˜ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
å°†æ•°ç»„è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²ä¿å­˜ï¼š

```javascript
// ä¿å­˜æ—¶
const taskData = {
  chunkUrlsJson: JSON.stringify(chunkUrls), // è½¬ä¸º JSON å­—ç¬¦ä¸²
  // ...
};

// è¯»å–æ—¶
let chunkUrls;
if (typeof task.chunkUrlsJson === 'string') {
  chunkUrls = JSON.parse(task.chunkUrlsJson);
} else if (Array.isArray(task.chunkUrls)) {
  chunkUrls = task.chunkUrls;
} else if (typeof task.chunkUrls === 'object') {
  // å¤„ç†å¯¹è±¡æ ¼å¼ï¼ˆæ•°æ®åº“å¯èƒ½å°†æ•°ç»„å­˜å‚¨ä¸ºå¯¹è±¡ï¼‰
  const keys = Object.keys(task.chunkUrls).sort((a, b) => parseInt(a) - parseInt(b));
  chunkUrls = keys.map(key => task.chunkUrls[key]);
}
```

**ç»éªŒæ€»ç»“**ï¼š
- æ•°æ®åº“å¯¹å¤æ‚æ•°æ®ç±»å‹æ”¯æŒæœ‰é™ï¼Œæ•°ç»„å»ºè®®è½¬ä¸º JSON å­—ç¬¦ä¸²
- è¯»å–æ—¶è¦å…¼å®¹å¤šç§æ ¼å¼ï¼ˆå­—ç¬¦ä¸²ã€æ•°ç»„ã€å¯¹è±¡ï¼‰

---

### ğŸ› å‘ 4ï¼šäº‘å‡½æ•°è·¯å¾„è§£æé—®é¢˜

**é—®é¢˜æè¿°**ï¼š
äº‘å‡½æ•°æ”¶åˆ°è¯·æ±‚è·¯å¾„ä¸º `/-api/storage/upload-chunk`ï¼Œå¯¼è‡´è·¯ç”±åŒ¹é…å¤±è´¥ã€‚

**é”™è¯¯ä¿¡æ¯**ï¼š
```
æœªçŸ¥è·¯å¾„: /-api/storage/upload-chunk
```

**åŸå› åˆ†æ**ï¼š
è…¾è®¯äº‘å‡½æ•°çš„è·¯å¾„æ ¼å¼ç‰¹æ®Šï¼Œå‡½æ•°åå‰ç¼€å’Œè·¯å¾„æ‹¼æ¥æ—¶å¯èƒ½å‡ºç° `/-api/` è¿™æ ·çš„æ ¼å¼ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
å®Œå–„è·¯å¾„è§£æé€»è¾‘ï¼š

```javascript
// ç§»é™¤å‡½æ•°åå‰ç¼€
if (path.startsWith(`/${functionName}`)) {
  path = path.replace(`/${functionName}`, '') || '/';
}

// å¤„ç† -api åç¼€
if (path.startsWith('/-api/')) {
  path = path.replace('/-api/', '/');
} else if (path === '/-api') {
  path = '/';
}

// å¤„ç†åŒ…å« -api/ çš„æƒ…å†µ
if (path.includes('-api/')) {
  path = path.replace(/-api\//g, '/');
}
```

**ç»éªŒæ€»ç»“**ï¼š
- äº‘å‡½æ•°çš„è·¯å¾„æ ¼å¼å¯èƒ½å› éƒ¨ç½²æ–¹å¼è€Œå¼‚ï¼Œéœ€è¦å…¼å®¹å¤šç§æ ¼å¼
- æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼Œæ–¹ä¾¿è°ƒè¯•è·¯å¾„è§£æé—®é¢˜

---

### ğŸ› å‘ 5ï¼šåˆå¹¶ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢é—®é¢˜

**é—®é¢˜æè¿°**ï¼š
åˆå¹¶ä»»åŠ¡å·²å®Œæˆï¼Œä½†æŸ¥è¯¢çŠ¶æ€æ—¶è¿”å› `status: 'pending'`ã€‚

**é”™è¯¯ä¿¡æ¯**ï¼š
```
ç­‰å¾…åˆå¹¶ä»»åŠ¡è¶…æ—¶ï¼ˆå·²æŸ¥è¯¢ 3 æ¬¡ï¼‰
status: pending, progress: 0
```

**åŸå› åˆ†æ**ï¼š
1. æ•°æ®åº“è¿”å›çš„æ•°æ®æ ¼å¼ä¸ä¸€è‡´ï¼ˆå¯èƒ½æ˜¯æ•°ç»„ `[{...}]` æˆ–å¯¹è±¡ `{...}`ï¼‰
2. æŸ¥è¯¢æ—¶æ²¡æœ‰æ­£ç¡®å¤„ç†æ•°ç»„æ ¼å¼

**è§£å†³æ–¹æ¡ˆ**ï¼š
å…¼å®¹å¤šç§æ•°æ®æ ¼å¼ï¼š

```javascript
// å¤„ç†æ•°æ®åº“è¿”å›çš„æ•°æ®æ ¼å¼
let task;
if (Array.isArray(taskDoc.data)) {
  if (taskDoc.data.length === 0) {
    return { code: 404, message: 'ä»»åŠ¡ä¸å­˜åœ¨' };
  }
  task = taskDoc.data[0]; // å–ç¬¬ä¸€ä¸ªå…ƒç´ 
} else if (taskDoc.data) {
  task = taskDoc.data; // ç›´æ¥ä½¿ç”¨
} else {
  return { code: 404, message: 'ä»»åŠ¡ä¸å­˜åœ¨' };
}
```

**ç»éªŒæ€»ç»“**ï¼š
- æ•°æ®åº“æŸ¥è¯¢ç»“æœæ ¼å¼å¯èƒ½ä¸ä¸€è‡´ï¼Œéœ€è¦å…¼å®¹å¤„ç†
- æ·»åŠ æ•°æ®æ ¼å¼éªŒè¯å’Œæ—¥å¿—è¾“å‡º

---

### ğŸ› å‘ 6ï¼šå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œé—®é¢˜

**é—®é¢˜æè¿°**ï¼š
åˆå¹¶ä»»åŠ¡åˆ›å»ºåï¼Œä½¿ç”¨ `setTimeout` å¼‚æ­¥æ‰§è¡Œï¼Œä½†ä»»åŠ¡æ²¡æœ‰è¢«å¤„ç†ã€‚

**é”™è¯¯ä¿¡æ¯**ï¼š
```
å¤„ç†åˆå¹¶ä»»åŠ¡å¤±è´¥: ä»»åŠ¡æ•°æ®æ— æ•ˆ: chunkUrls ä¸å­˜åœ¨
```

**åŸå› åˆ†æ**ï¼š
TCB äº‘å‡½æ•°åœ¨è¿”å›åï¼Œ`setTimeout` ä¸­çš„å¼‚æ­¥ä»»åŠ¡å¯èƒ½ä¸ä¼šç»§ç»­æ‰§è¡Œï¼Œå¯¼è‡´åˆå¹¶ä»»åŠ¡æ²¡æœ‰è¢«å¤„ç†ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
æ”¹ä¸ºåœ¨äº‘å‡½æ•°å†…éƒ¨åŒæ­¥è§¦å‘ï¼Œä½†ç«‹å³è¿”å›ï¼š

```javascript
// å¼‚æ­¥å¤„ç†åˆå¹¶ä»»åŠ¡ï¼Œä¸ç­‰å¾…å®Œæˆ
processMergeTask(taskId).catch(error => {
  console.error('å¼‚æ­¥å¤„ç†å¤±è´¥:', error);
  // æ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸ºå¤±è´¥
  db.collection('merge_tasks').doc(taskId).update({
    status: 'failed',
    error: error.message,
  });
});

// ç«‹å³è¿”å›
return {
  code: 0,
  message: 'åˆå¹¶ä»»åŠ¡å¤„ç†å·²å¯åŠ¨ï¼ˆå¼‚æ­¥æ‰§è¡Œï¼‰',
  data: { taskId },
};
```

**ç»éªŒæ€»ç»“**ï¼š
- äº‘å‡½æ•°è¿”å›åï¼Œå¼‚æ­¥ä»»åŠ¡å¯èƒ½ä¸ä¼šæ‰§è¡Œ
- åº”è¯¥åœ¨å‡½æ•°å†…éƒ¨å¯åŠ¨å¼‚æ­¥ä»»åŠ¡ï¼Œä½†ç«‹å³è¿”å›ï¼Œä¸ç­‰å¾…å®Œæˆ

---

### ğŸ› å‘ 7ï¼šæ•°æ®åº“ _id å­—æ®µé—®é¢˜

**é—®é¢˜æè¿°**ï¼š
ä¿å­˜åˆå¹¶ä»»åŠ¡æ—¶ï¼Œé‡åˆ° `Cannot update _id value` é”™è¯¯ã€‚

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Cannot update _id value
```

**åŸå› åˆ†æ**ï¼š
è…¾è®¯äº‘æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆ `_id` å­—æ®µï¼Œä¸èƒ½æ‰‹åŠ¨è®¾ç½®ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
ç§»é™¤ `_id` å­—æ®µï¼Œè®©æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆï¼š

```javascript
// âŒ é”™è¯¯
const taskData = {
  _id: taskId,  // ä¸èƒ½æ‰‹åŠ¨è®¾ç½®
  taskId: taskId,
  // ...
};

// âœ… æ­£ç¡®
const taskData = {
  taskId: taskId,  // ä½¿ç”¨è‡ªå®šä¹‰å­—æ®µ
  // ...
};
```

**ç»éªŒæ€»ç»“**ï¼š
- æ•°æ®åº“çš„ `_id` å­—æ®µæ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä¸èƒ½æ‰‹åŠ¨è®¾ç½®
- å¦‚æœéœ€è¦è‡ªå®šä¹‰ IDï¼Œä½¿ç”¨å…¶ä»–å­—æ®µåï¼ˆå¦‚ `taskId`ï¼‰

---

### ğŸ› å‘ 8ï¼šä¸´æ—¶å‡­è¯ä½¿ç”¨é—®é¢˜

**é—®é¢˜æè¿°**ï¼š
å°è¯•ä½¿ç”¨ TCB çš„ `getUploadMetadata` è¿”å›çš„ä¸´æ—¶å‡­è¯ç›´æ¥ä¸Šä¼ åˆ° COSï¼Œä½†ç­¾åéªŒè¯å¤±è´¥ã€‚

**é”™è¯¯ä¿¡æ¯**ï¼š
```
SignatureDoesNotMatch
```

**åŸå› åˆ†æ**ï¼š
TCB çš„ `getUploadMetadata` è¿”å›çš„å‡­è¯æ ¼å¼ç‰¹æ®Šï¼Œä¸»è¦ç”¨äºå®¢æˆ·ç«¯ SDKï¼Œä¸é€‚åˆç›´æ¥ç”¨äº HTTP PUTã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
æ”¾å¼ƒç›´æ¥ä¸Šä¼ æ–¹æ¡ˆï¼Œç»Ÿä¸€ä½¿ç”¨åˆ†ç‰‡ä¸Šä¼ é€šè¿‡äº‘å‡½æ•°ä¸­è½¬ã€‚

**ç»éªŒæ€»ç»“**ï¼š
- TCB çš„ä¸´æ—¶å‡­è¯ä¸»è¦ç”¨äºå®¢æˆ·ç«¯ SDK
- æœåŠ¡ç«¯ä¸Šä¼ åº”è¯¥é€šè¿‡äº‘å‡½æ•°ä¸­è½¬ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ä¸´æ—¶å‡­è¯

---

### ğŸ› å‘ 9ï¼šç‰ˆæœ¬å·å­—æ®µæ··æ·†

**é—®é¢˜æè¿°**ï¼š
åˆå§‹å®ç°ä¸­ï¼ŒJS Bundle æ›´æ–°å’Œ APK æ›´æ–°éƒ½ä½¿ç”¨ `versionCode`ï¼Œå¯¼è‡´ç‰ˆæœ¬å·æ··æ·†ã€‚

**é—®é¢˜åœºæ™¯**ï¼š
- APK ç‰ˆæœ¬ï¼š`versionCode = 2`
- JS Bundle ç‰ˆæœ¬ï¼š`versionCode = 1`
- ç”¨æˆ·æ›´æ–° JS Bundle åï¼Œ`versionCode` å˜æˆ 1ï¼Œå¯¼è‡´ç³»ç»Ÿè®¤ä¸ºéœ€è¦æ›´æ–° APK

**è§£å†³æ–¹æ¡ˆ**ï¼š
å¼•å…¥ç‹¬ç«‹çš„ `jsVersionCode`ï¼š

```javascript
// APK ç‰ˆæœ¬ç®¡ç†
{
  versionCode: 2  // ä» app.json è¯»å–
}

// JS Bundle ç‰ˆæœ¬ç®¡ç†
{
  jsVersionCode: 1  // ç‹¬ç«‹ç®¡ç†ï¼Œè‡ªåŠ¨é€’å¢
}
```

**ç»éªŒæ€»ç»“**ï¼š
- ä¸åŒç±»å‹çš„æ›´æ–°åº”è¯¥ä½¿ç”¨ç‹¬ç«‹çš„ç‰ˆæœ¬å·å­—æ®µ
- é¿å…ç‰ˆæœ¬å·æ··æ·†ï¼Œç¡®ä¿æ›´æ–°é€»è¾‘æ¸…æ™°

---

## 7. å®Œæ•´ä»£ç å®ç°

### 7.1 ä¸Šä¼ è„šæœ¬æ ¸å¿ƒä»£ç 

```javascript
// scripts/upload-js-bundle.js

// åˆ†ç‰‡ä¸Šä¼ 
async function uploadInChunks(filePath, cloudPath, fileName) {
  const fileContent = fs.readFileSync(filePath);
  const CHUNK_SIZE = 2 * 1024 * 1024; // 2MB
  const totalChunks = Math.ceil(fileContent.length / CHUNK_SIZE);
  
  // ä¸Šä¼ æ‰€æœ‰åˆ†ç‰‡
  for (let i = 0; i < totalChunks; i++) {
    const start = i * CHUNK_SIZE;
    const end = Math.min(start + CHUNK_SIZE, fileContent.length);
    const chunk = fileContent.slice(start, end);
    const chunkBase64 = chunk.toString('base64');
    
    await uploadChunk(uploadId, i, chunkBase64, totalChunks);
  }
  
  // å®Œæˆåˆ†ç‰‡ä¸Šä¼ ï¼Œåˆ›å»ºåˆå¹¶ä»»åŠ¡
  const result = await completeChunkUpload(uploadId, totalChunks, cloudPath, fileName);
  
  // è§¦å‘åˆå¹¶ä»»åŠ¡å¤„ç†
  await triggerMergeTask(result.taskId);
  
  // ç­‰å¾…åˆå¹¶ä»»åŠ¡å®Œæˆ
  await waitForMergeTask(result.taskId);
}
```

### 7.2 äº‘å‡½æ•°æ ¸å¿ƒä»£ç 

```javascript
// cloud-function/app-update/index.js

// ä¿å­˜ç‰ˆæœ¬ä¿¡æ¯ï¼ˆè‡ªåŠ¨é€’å¢ jsVersionCodeï¼‰
async function handleStorageUploadFinish(method, path, body, headers) {
  const { version, platform, downloadUrl, filePath, fileSize } = body;
  
  // æŸ¥è¯¢å½“å‰æœ€å¤§ jsVersionCode
  const existingVersions = await collection
    .where({ platform: platform })
    .orderBy('jsVersionCode', 'desc')
    .limit(1)
    .get();
  
  let jsVersionCode = 1;
  if (existingVersions.data && existingVersions.data.length > 0) {
    jsVersionCode = existingVersions.data[0].jsVersionCode + 1;
  }
  
  // ä¿å­˜ç‰ˆæœ¬è®°å½•
  await collection.add({
    version,
    jsVersionCode,
    platform,
    downloadUrl,
    filePath,
    fileSize,
    releaseDate: new Date().toISOString(),
  });
}

// æ£€æŸ¥æ›´æ–°
async function handleJSBundleCheckUpdate(method, path, body, headers) {
  const currentJsVersionCode = parseInt(queryParams.get('jsVersionCode') || '0', 10);
  
  // æŸ¥è¯¢æœ€æ–°ç‰ˆæœ¬
  const versions = await versionsCollection
    .where({ platform: platform })
    .orderBy('jsVersionCode', 'desc')
    .limit(1)
    .get();
  
  const latestVersion = versions.data[0];
  const latestJsVersionCode = latestVersion.jsVersionCode;
  
  // æ¯”è¾ƒç‰ˆæœ¬
  const hasUpdate = latestJsVersionCode > currentJsVersionCode;
  
  return {
    code: 0,
    data: {
      hasUpdate,
      latestJsVersionCode,
      downloadUrl: latestVersion.downloadUrl,
      // ...
    },
  };
}
```

### 7.3 å®¢æˆ·ç«¯æ ¸å¿ƒä»£ç 

```typescript
// services/js-bundle-update.service.ts

class JSBundleUpdateService {
  private currentJsVersionCode: number = 0;
  
  // ä»æœ¬åœ°å­˜å‚¨åŠ è½½ jsVersionCode
  private async loadJsVersionCode(): Promise<void> {
    const infoPath = `${FileSystem.documentDirectory}js_bundle_version_code.json`;
    const fileInfo = await FileSystem.getInfoAsync(infoPath);
    
    if (fileInfo.exists) {
      const content = await FileSystem.readAsStringAsync(infoPath);
      const data = JSON.parse(content);
      this.currentJsVersionCode = data.jsVersionCode || 0;
    }
  }
  
  // æ£€æŸ¥æ›´æ–°
  async checkForUpdate(): Promise<JSBundleUpdateInfo> {
    await this.loadJsVersionCode();
    
    const response = await fetch(
      `${updateServiceUrl}/app/check-js-bundle-update?jsVersionCode=${this.currentJsVersionCode}&platform=${Platform.OS}`
    );
    
    const result = await response.json();
    return result.data;
  }
  
  // åº”ç”¨æ›´æ–°
  async applyUpdate(bundlePath: string, latestJsVersionCode: number): Promise<void> {
    const ext = bundlePath.split('.').pop()?.toLowerCase();
    
    if (ext === 'js') {
      // åŠ¨æ€æ‰§è¡Œ
      await this.runBundle(bundlePath);
      await this.saveJsVersionCode(latestJsVersionCode);
      Alert.alert('æ›´æ–°å®Œæˆ', 'æ–°ç‰ˆæœ¬å·²åº”ç”¨ï¼ˆæ— éœ€é‡å¯ï¼‰');
    } else if (ext === 'hbc') {
      // ä¿å­˜æ›´æ–°ä¿¡æ¯
      await FileSystem.writeAsStringAsync(infoPath, JSON.stringify({
        bundlePath,
        jsVersionCode: latestJsVersionCode,
      }));
      await this.saveJsVersionCode(latestJsVersionCode);
      Alert.alert('æ›´æ–°ä¸‹è½½å®Œæˆ', 'ä¸‹æ¬¡é‡å¯åå°†åº”ç”¨æ–°ç‰ˆæœ¬');
    }
  }
}
```

---

## 8. æ€»ç»“ä¸å±•æœ›

### 8.1 æ ¸å¿ƒè¦ç‚¹æ€»ç»“

1. **åˆ†ç‰‡ä¸Šä¼ **ï¼šè§£å†³äº‘å‡½æ•° 6MB é™åˆ¶ï¼Œæ”¯æŒå¤§æ–‡ä»¶ä¸Šä¼ 
2. **å¼‚æ­¥åˆå¹¶**ï¼šé¿å…äº‘å‡½æ•°è¶…æ—¶ï¼Œæé«˜ç”¨æˆ·ä½“éªŒ
3. **ç‹¬ç«‹ç‰ˆæœ¬ç®¡ç†**ï¼šä½¿ç”¨ `jsVersionCode`ï¼Œä¸ APK ç‰ˆæœ¬åˆ†ç¦»
4. **è‡ªåŠ¨é€’å¢**ï¼šä¸Šä¼ æ—¶è‡ªåŠ¨é€’å¢ç‰ˆæœ¬å·ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†
5. **æœ¬åœ°å­˜å‚¨**ï¼š`jsVersionCode` ä¿å­˜åœ¨æœ¬åœ°ï¼ŒæŒä¹…åŒ–æ›´æ–°çŠ¶æ€
6. **ä»…æ‰‹åŠ¨æ›´æ–°**ï¼šç”¨æˆ·å®Œå…¨æ§åˆ¶ï¼Œä¸ä¼šè‡ªåŠ¨æ£€æŸ¥æˆ–ä¸‹è½½

### 8.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **åˆ†ç‰‡å¤§å°ä¼˜åŒ–**ï¼šæ ¹æ®ç½‘ç»œæƒ…å†µåŠ¨æ€è°ƒæ•´åˆ†ç‰‡å¤§å°
2. **å¹¶å‘ä¸Šä¼ **ï¼šæ”¯æŒå¤šä¸ªåˆ†ç‰‡å¹¶å‘ä¸Šä¼ ï¼Œæé«˜é€Ÿåº¦
3. **æ–­ç‚¹ç»­ä¼ **ï¼šæ”¯æŒä¸‹è½½ä¸­æ–­åç»§ç»­ä¸‹è½½
4. **å¢é‡æ›´æ–°**ï¼šæ”¯æŒåªä¸‹è½½å˜æ›´éƒ¨åˆ†ï¼Œå‡å°‘æµé‡

### 8.3 å®‰å…¨æ€§è€ƒè™‘

1. **æ–‡ä»¶æ ¡éªŒ**ï¼šä¸‹è½½åæ ¡éªŒæ–‡ä»¶ MD5ï¼Œç¡®ä¿å®Œæ•´æ€§
2. **ç­¾åéªŒè¯**ï¼šå¯¹ JS Bundle è¿›è¡Œç­¾åï¼Œé˜²æ­¢ç¯¡æ”¹
3. **æƒé™æ§åˆ¶**ï¼šä¸Šä¼ å’Œä¸‹è½½éƒ½éœ€è¦ API Key è®¤è¯
4. **ç‰ˆæœ¬å›æ»š**ï¼šæ”¯æŒå›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬

### 8.4 æœªæ¥æ”¹è¿›æ–¹å‘

1. **å¢é‡æ›´æ–°**ï¼šåªä¸‹è½½å˜æ›´çš„ä»£ç å—
2. **å‹ç¼©ä¼˜åŒ–**ï¼šä½¿ç”¨æ›´é«˜æ•ˆçš„å‹ç¼©ç®—æ³•
3. **CDN åŠ é€Ÿ**ï¼šä½¿ç”¨ CDN åŠ é€Ÿæ–‡ä»¶ä¸‹è½½
4. **ç°åº¦å‘å¸ƒ**ï¼šæ”¯æŒæŒ‰ç”¨æˆ·æ¯”ä¾‹é€æ­¥å‘å¸ƒæ›´æ–°

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [è…¾è®¯äº‘å¼€å‘æ–‡æ¡£](https://cloud.tencent.com/document/product/876)
- [Expo FileSystem æ–‡æ¡£](https://docs.expo.dev/versions/latest/sdk/filesystem/)
- [React Native çƒ­æ›´æ–°æ–¹æ¡ˆå¯¹æ¯”](https://reactnative.dev/docs/upgrading)

---

## ğŸ’¬ å†™åœ¨æœ€å

è‡ªå»º OTA æ›´æ–°ç³»ç»Ÿè™½ç„¶å®ç°å¤æ‚ï¼Œä½†å®Œå…¨å¯æ§ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚çµæ´»å®šåˆ¶ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†å¾ˆå¤šå‘ï¼Œä½†é€šè¿‡ä¸æ–­è°ƒè¯•å’Œä¼˜åŒ–ï¼Œæœ€ç»ˆå®ç°äº†ä¸€ä¸ªç¨³å®šå¯é çš„æ›´æ–°ç³»ç»Ÿã€‚

å¸Œæœ›æœ¬æ–‡èƒ½å¸®åŠ©åˆ°æ­£åœ¨å®ç°ç±»ä¼¼åŠŸèƒ½çš„å¼€å‘è€…ï¼Œé¿å…é‡å¤è¸©å‘ã€‚å¦‚æœé‡åˆ°é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµè®¨è®ºã€‚

**å¦‚æœè§‰å¾—æœ¬æ–‡æœ‰å¸®åŠ©ï¼Œè¯·ç‚¹èµã€æ”¶è—ã€å…³æ³¨ï¼** ğŸ‘

---

**ä½œè€…**ï¼š[ä½ çš„åå­—]  
**æ—¥æœŸ**ï¼š2025-01-11  
**ç‰ˆæƒå£°æ˜**ï¼šæœ¬æ–‡ä¸ºåŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚


