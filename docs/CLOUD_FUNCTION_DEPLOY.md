# äº‘å‡½æ•°éƒ¨ç½²å®Œæ•´æŒ‡å—

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜å¦‚ä½•æ­£ç¡®éƒ¨ç½²è…¾è®¯äº‘å‡½æ•°ï¼Œè§£å†³å¸¸è§çš„ä¾èµ–é—®é¢˜ã€‚

## ğŸš¨ å¸¸è§é”™è¯¯

### é”™è¯¯ï¼š`Cannot find module '@cloudbase/node-sdk'`

**åŸå› ï¼š** äº‘å‡½æ•°ä»£ç ä¸­ä½¿ç”¨äº† `@cloudbase/node-sdk`ï¼Œä½†ä¾èµ–æ²¡æœ‰æ­£ç¡®å®‰è£…ã€‚

**è§£å†³æ–¹æ³•ï¼š** æŒ‰ç…§ä¸‹æ–¹æ­¥éª¤æ­£ç¡®å®‰è£…ä¾èµ–ã€‚

## ğŸ“¦ äº‘å‡½æ•°é¡¹ç›®ç»“æ„

```
task-collection-function/
â”œâ”€â”€ index.js              # ä¸»å…¥å£æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
â”œâ”€â”€ package.json          # ä¾èµ–é…ç½®ï¼ˆå¿…éœ€ï¼‰
â””â”€â”€ node_modules/        # ä¾èµ–åŒ…ï¼ˆä¸Šä¼ æ—¶éœ€è¦ï¼‰
```

## ğŸš€ éƒ¨ç½²æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šæœ¬åœ°ä¸Šä¼ ï¼ˆæ¨èï¼‰

#### æ­¥éª¤ 1ï¼šåˆ›å»ºé¡¹ç›®ç›®å½•

```bash
# åˆ›å»ºäº‘å‡½æ•°ç›®å½•
mkdir task-collection-function
cd task-collection-function
```

#### æ­¥éª¤ 2ï¼šåˆ›å»º package.json

åˆ›å»º `package.json` æ–‡ä»¶ï¼š

```json
{
  "name": "task-collection-api",
  "version": "1.0.0",
  "description": "ä»»åŠ¡æ”¶é›†åº”ç”¨åç«¯ API",
  "main": "index.js",
  "dependencies": {
    "@cloudbase/node-sdk": "^2.5.0"
  }
}
```

#### æ­¥éª¤ 3ï¼šå®‰è£…ä¾èµ–

```bash
npm install
```

è¿™ä¼šåœ¨å½“å‰ç›®å½•åˆ›å»º `node_modules` æ–‡ä»¶å¤¹ï¼ŒåŒ…å« `@cloudbase/node-sdk` åŠå…¶ä¾èµ–ã€‚

#### æ­¥éª¤ 4ï¼šåˆ›å»º index.js

å°† `docs/tencent-cloud-function-example.md` ä¸­çš„å®Œæ•´ä»£ç å¤åˆ¶åˆ° `index.js` æ–‡ä»¶ã€‚

#### æ­¥éª¤ 5ï¼šæ‰“åŒ…ä¸Šä¼ 

**Windows PowerShell:**
```powershell
# å‹ç¼©æ–‡ä»¶å¤¹ï¼ˆéœ€è¦å®‰è£… 7-Zip æˆ–ä½¿ç”¨å…¶ä»–å‹ç¼©å·¥å…·ï¼‰
Compress-Archive -Path .\* -DestinationPath ..\task-collection-function.zip
```

**æˆ–è€…æ‰‹åŠ¨æ“ä½œï¼š**
1. é€‰ä¸­ `task-collection-function` æ–‡ä»¶å¤¹
2. å³é”® â†’ å‘é€åˆ° â†’ å‹ç¼©(zipped)æ–‡ä»¶å¤¹

**é‡è¦ï¼š** å‹ç¼©åŒ…å†…åº”è¯¥æ˜¯ï¼š
```
task-collection-function.zip
â”œâ”€â”€ index.js
â”œâ”€â”€ package.json
â””â”€â”€ node_modules/
    â””â”€â”€ @cloudbase/
        â””â”€â”€ node-sdk/
            â””â”€â”€ ...
```

**ä¸è¦**å‹ç¼©æˆï¼š
```
task-collection-function.zip
â””â”€â”€ task-collection-function/
    â”œâ”€â”€ index.js
    â”œâ”€â”€ package.json
    â””â”€â”€ node_modules/
```

#### æ­¥éª¤ 6ï¼šä¸Šä¼ åˆ°äº‘å‡½æ•°

1. ç™»å½• [è…¾è®¯äº‘å¼€å‘æ§åˆ¶å°](https://console.cloud.tencent.com/tcb)
2. è¿›å…¥"äº‘å‡½æ•°" â†’ "å‡½æ•°ç®¡ç†"
3. é€‰æ‹©æˆ–åˆ›å»ºå‡½æ•°ï¼š`task-collection-api`
4. ç‚¹å‡»"ä¸Šä¼ ä»£ç "
5. é€‰æ‹©"æœ¬åœ°ä¸Šä¼ zipåŒ…"
6. é€‰æ‹©åˆšæ‰åˆ›å»ºçš„ `task-collection-function.zip`
7. ç‚¹å‡»"ä¸Šä¼ å¹¶éƒ¨ç½²"

### æ–¹æ³•äºŒï¼šåœ¨çº¿ç¼–è¾‘ï¼ˆé€‚åˆå¿«é€Ÿæµ‹è¯•ï¼‰

#### æ­¥éª¤ 1ï¼šåˆ›å»ºäº‘å‡½æ•°

1. ç™»å½• [è…¾è®¯äº‘å¼€å‘æ§åˆ¶å°](https://console.cloud.tencent.com/tcb)
2. è¿›å…¥"äº‘å‡½æ•°" â†’ "å‡½æ•°ç®¡ç†"
3. ç‚¹å‡»"æ–°å»ºäº‘å‡½æ•°"
4. å‡½æ•°åç§°ï¼š`task-collection-api`
5. è¿è¡Œç¯å¢ƒï¼šNode.js 16 æˆ– Node.js 18
6. åˆ›å»ºæ–¹å¼ï¼šé€‰æ‹©"åœ¨çº¿ç¼–è¾‘"

#### æ­¥éª¤ 2ï¼šå®‰è£…ä¾èµ–

1. åœ¨äº‘å‡½æ•°ç¼–è¾‘é¡µé¢ï¼Œç‚¹å‡»"ç»ˆç«¯"æ ‡ç­¾
2. åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œï¼š
   ```bash
   npm install @cloudbase/node-sdk
   ```
3. ç­‰å¾…å®‰è£…å®Œæˆ

#### æ­¥éª¤ 3ï¼šç¼–å†™ä»£ç 

1. ç‚¹å‡»"å‡½æ•°ä»£ç "æ ‡ç­¾
2. å°† `docs/tencent-cloud-function-example.md` ä¸­çš„å®Œæ•´ä»£ç å¤åˆ¶åˆ°ç¼–è¾‘å™¨
3. ä¿å­˜ä»£ç ï¼ˆCtrl+Sï¼‰

#### æ­¥éª¤ 4ï¼šéƒ¨ç½²

1. ç‚¹å‡»"éƒ¨ç½²"æŒ‰é’®
2. ç­‰å¾…éƒ¨ç½²å®Œæˆ

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨äº‘å¼€å‘ CLIï¼ˆé«˜çº§ï¼‰

å¦‚æœä½ ç†Ÿæ‚‰å‘½ä»¤è¡Œå·¥å…·ï¼š

```bash
# å®‰è£…äº‘å¼€å‘ CLI
npm install -g @cloudbase/cli

# ç™»å½•
tcb login

# åˆå§‹åŒ–äº‘å‡½æ•°
tcb fn init task-collection-api

# è¿›å…¥ç›®å½•
cd task-collection-api

# å®‰è£…ä¾èµ–
npm install @cloudbase/node-sdk

# ç¼–å†™ä»£ç ï¼ˆå¤åˆ¶ index.jsï¼‰

# éƒ¨ç½²
tcb fn deploy task-collection-api
```

## âœ… éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥äº‘å‡½æ•°æ—¥å¿—

1. åœ¨äº‘å‡½æ•°æ§åˆ¶å°ï¼Œç‚¹å‡»å‡½æ•°åç§°
2. è¿›å…¥"æ—¥å¿—"æ ‡ç­¾
3. æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

### 2. æµ‹è¯•äº‘å‡½æ•°

ä½¿ç”¨æµ‹è¯•é¡µé¢æˆ–å‘½ä»¤è¡Œæµ‹è¯•ï¼š

```bash
# ä½¿ç”¨æµ‹è¯•è„šæœ¬
node scripts/test-cloud-function.js
```

æˆ–åœ¨æµè§ˆå™¨è®¿é—® `/test-api` é¡µé¢ã€‚

### 3. æŸ¥çœ‹ä¾èµ–

å¦‚æœä½¿ç”¨åœ¨çº¿ç¼–è¾‘ï¼Œå¯ä»¥åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œï¼š

```bash
# æŸ¥çœ‹å·²å®‰è£…çš„ä¾èµ–
npm list

# åº”è¯¥çœ‹åˆ° @cloudbase/node-sdk
```

## ğŸ”§ é…ç½®ç¯å¢ƒå˜é‡

éƒ¨ç½²å®Œæˆåï¼Œéœ€è¦é…ç½®ç¯å¢ƒå˜é‡ï¼š

1. åœ¨äº‘å‡½æ•°æ§åˆ¶å°ï¼Œç‚¹å‡»å‡½æ•°åç§°
2. è¿›å…¥"ç¯å¢ƒå˜é‡"æ ‡ç­¾
3. æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

| å˜é‡å | å€¼ | è¯´æ˜ |
|--------|-----|------|
| `TCB_ENV` | ä½ çš„ç¯å¢ƒID | äº‘å¼€å‘ç¯å¢ƒID |
| `API_KEY_1` | ä½ çš„API Key | ç”¨äºéªŒè¯è¯·æ±‚ |
| `API_KEY_2` | (å¯é€‰) | ç¬¬äºŒä¸ªAPI Key |

**å¦‚ä½•è·å–ç¯å¢ƒIDï¼š**
- åœ¨äº‘å¼€å‘æ§åˆ¶å°é¦–é¡µï¼Œå¯ä»¥çœ‹åˆ°ç¯å¢ƒID
- æ ¼å¼ç±»ä¼¼ï¼š`cloud1-xxxxx`

## ğŸŒ é…ç½® HTTP è§¦å‘å™¨

1. åœ¨äº‘å‡½æ•°æ§åˆ¶å°ï¼Œç‚¹å‡»å‡½æ•°åç§°
2. è¿›å…¥"è§¦å‘ç®¡ç†"æ ‡ç­¾
3. ç‚¹å‡»"åˆ›å»ºè§¦å‘å™¨"
4. é€‰æ‹©"HTTP è§¦å‘å™¨"
5. é…ç½®ï¼š
   - è§¦å‘è·¯å¾„ï¼š`/`ï¼ˆæˆ–è‡ªå®šä¹‰ï¼‰
   - è¯·æ±‚æ–¹æ³•ï¼š`GET, POST, PUT, DELETE, OPTIONS`
   - å¯ç”¨ CORSï¼šæ˜¯
6. ä¿å­˜åè·å–è§¦å‘å™¨ URL
7. å°† URL é…ç½®åˆ° `config/api.config.ts` ä¸­çš„ `BASE_URL`

## ğŸ“ å®Œæ•´ç¤ºä¾‹ package.json

```json
{
  "name": "task-collection-api",
  "version": "1.0.0",
  "description": "ä»»åŠ¡æ”¶é›†åº”ç”¨åç«¯ API",
  "main": "index.js",
  "dependencies": {
    "@cloudbase/node-sdk": "^2.5.0"
  },
  "engines": {
    "node": ">=16.0.0"
  }
}
```

## ğŸ› å¸¸è§é—®é¢˜

### Q1: ä¸Šä¼ åä»ç„¶æŠ¥é”™ "Cannot find module"

**è§£å†³æ–¹æ³•ï¼š**
1. ç¡®è®¤ `package.json` ä¸­åŒ…å« `@cloudbase/node-sdk`
2. ç¡®è®¤ `node_modules` æ–‡ä»¶å¤¹å·²åŒ…å«åœ¨å‹ç¼©åŒ…ä¸­
3. ç¡®è®¤å‹ç¼©åŒ…ç»“æ„æ­£ç¡®ï¼ˆä¸è¦å¤šä¸€å±‚ç›®å½•ï¼‰
4. å°è¯•é‡æ–°å®‰è£…ä¾èµ–ï¼š
   ```bash
   rm -rf node_modules package-lock.json
   npm install
   ```

### Q2: åœ¨çº¿ç¼–è¾‘ä¸­ npm install å¤±è´¥

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. å°è¯•ä½¿ç”¨å›½å†…é•œåƒï¼š
   ```bash
   npm install @cloudbase/node-sdk --registry=https://registry.npmmirror.com
   ```
3. å¦‚æœä»ç„¶å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°ä¸Šä¼ æ–¹å¼

### Q3: ä¾èµ–ç‰ˆæœ¬ä¸å…¼å®¹

**è§£å†³æ–¹æ³•ï¼š**
1. æŸ¥çœ‹äº‘å‡½æ•°è¿è¡Œç¯å¢ƒï¼ˆNode.js ç‰ˆæœ¬ï¼‰
2. ä½¿ç”¨å…¼å®¹çš„ `@cloudbase/node-sdk` ç‰ˆæœ¬ï¼š
   - Node.js 16: `@cloudbase/node-sdk@^2.5.0`
   - Node.js 18: `@cloudbase/node-sdk@^2.5.0` æˆ–æ›´é«˜ç‰ˆæœ¬

### Q4: å‹ç¼©åŒ…å¤ªå¤§æ— æ³•ä¸Šä¼ 

**è§£å†³æ–¹æ³•ï¼š**
1. åªä¸Šä¼ å¿…è¦çš„æ–‡ä»¶ï¼š
   - `index.js`
   - `package.json`
   - `node_modules/`ï¼ˆå¿…éœ€ï¼‰
2. ä¸è¦åŒ…å«ï¼š
   - `.git/`
   - `node_modules/.cache/`
   - å…¶ä»–æµ‹è¯•æ–‡ä»¶
3. å¦‚æœä»ç„¶å¤ªå¤§ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨äº‘å‡½æ•°çš„"ä¾èµ–å®‰è£…"åŠŸèƒ½ï¼ˆå¦‚æœæ”¯æŒï¼‰

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [äº‘å‡½æ•°ç¤ºä¾‹ä»£ç ](./tencent-cloud-function-example.md)
- [è…¾è®¯äº‘å¼€å‘æ–‡æ¡£](https://cloud.tencent.com/document/product/876)
- [@cloudbase/node-sdk æ–‡æ¡£](https://cloudbase.net/docs/node-sdk/introduction.html)

## âœ… æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰è¯·ç¡®è®¤ï¼š

- [ ] `package.json` ä¸­åŒ…å« `@cloudbase/node-sdk` ä¾èµ–
- [ ] å·²æ‰§è¡Œ `npm install` å®‰è£…ä¾èµ–
- [ ] `index.js` ä»£ç å®Œæ•´ä¸”æ­£ç¡®
- [ ] å‹ç¼©åŒ…ç»“æ„æ­£ç¡®ï¼ˆç›´æ¥åŒ…å«æ–‡ä»¶ï¼Œä¸è¦å¤šä¸€å±‚ç›®å½•ï¼‰
- [ ] å·²é…ç½®ç¯å¢ƒå˜é‡ï¼ˆ`TCB_ENV`, `API_KEY_1`ï¼‰
- [ ] å·²åˆ›å»º HTTP è§¦å‘å™¨
- [ ] å·²åˆ›å»ºæ•°æ®åº“é›†åˆ `tasks`
- [ ] å·²æµ‹è¯•äº‘å‡½æ•°è°ƒç”¨

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œäº‘å‡½æ•°åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼

